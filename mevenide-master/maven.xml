<project default="build-all" 
		 xmlns:maven="jelly:maven" 
		 xmlns:j="jelly:core"
		 xmlns:velocity="jelly:org.apache.commons.jelly.tags.velocity.VelocityTagLibrary">

  <!-- 
  	TODO "debug" site generation !!!
  -->
  

  <preGoal name="build">
  	<!-- simulate project.properties inheritance -->
  	<j:if test="${properties.inheritance}">
  	  <copy file="${basedir}/project.properties" todir="${basedir}/../goals-grabber"/>	
  	  <copy file="${basedir}/project.properties" todir="${basedir}/../mevenide-core"/>	
  	  <copy file="${basedir}/project.properties" todir="${basedir}/../mevenide-ui-eclipse"/>	
  	</j:if>
  	<!-- 
  		ensure that all dependencies are present in the repository 
  		by copying all needed eclipse-plugins jars
  	-->
  	<copy file="${eclipse.home}/plugins/org.eclipse.core.resources_2.1.0/resources.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-resources-2.1.0.jar"/>
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.core_2.1.0/dtcore.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-dtcore-2.1.0.jar"/>
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.ui_2.1.0/dtui.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-dtui-2.1.0.jar"/>
  	<copy file="${eclipse.home}/plugins/org.eclipse.jdt.core_2.1.0/jdtcore.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-jdtcore-2.1.0.jar"/>
  	<copy file="${eclipse.home}/plugins/org.eclipse.jdt.launching_2.1.0/launching.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-launching-2.1.0.jar"/>
  	<copy file="${eclipse.home}/plugins/${swt.plugin.dir}/swt.jar" 
  		  tofile="${maven.home}/repository/eclipse/jars/eclipse-swt-2.1.0.jar"/>  	
  </preGoal>


  <goal name="build-all"
    	description="Build all Mevenide modules">
    <attainGoal name="build"/>
  </goal>
  
  <goal name="build" description="Build each Mevenide module">
	
	<echo>
		+-------------------------------------
		|  maven.home = ${maven.home}        
		|  maven.repo = ${maven.repo.local}   
		+-------------------------------------
	</echo>
	
    <maven:reactor basedir=".."
      			   includes="goals-grabber/project.xml,mevenide-core/project.xml,mevenide-ui-eclipse/project.xml"
      			   excludes="mevenide-master/project.xml"
      			   goals="clean,jar:install"
      			   banner="Building"
      			   ignoreFailures="false"/>
    
  </goal>
  
  <!-- build the aggregated site -->
  <goal name="build-site" description="Build Mevenide Site">
  	
  	<maven:reactor basedir=".."
      			   includes="goals-grabber/project.xml,mevenide-core/project.xml,mevenide-ui-eclipse/project.xml,mevenide-master/project.xml"
      			   goals="clean,site,site:fsdeploy"
      			   excludes=""
      			   banner="Building Site"
      			   ignoreFailures="false"
      			   postProcessing="true"/>
      			   
	<!-- fileScanner var="templates">
      <fileset dir="${basedir}/templates">
        <include name="*.xml"/>
      </fileset>
    </fileScanner>
  	
  	<j:forEach var="template" items="${templates.iterator()}">
      
      <j:set var="templateName" value="${template.name}"/>
      <echo>Processing ${templateName} template ...</echo> 
    
      <velocity:merge name="${basedir}/xdocs/${templateName}"
        			  basedir="${basedir}/templates"
        			  template="${templateName}"/>

    </j:forEach -->
     
     
    <copy file="${basedir}/xdocs/images/mevenide-logo.jpg" todir="${basedir}/../goals-grabber/target/docs/images/"/>		
    <copy file="${basedir}/xdocs/images/mevenide-logo.jpg" todir="${basedir}/../mevenide-core/target/docs/images/"/>
    <copy file="${basedir}/xdocs/images/mevenide-logo.jpg" todir="${basedir}/../mevenide-ui-eclipse/target/docs/images/"/>
    <copy file="${basedir}/xdocs/images/mevenide-logo.jpg" todir="${basedir}/../mevenide-master/target/docs/images/"/>		   
    
  </goal>
  
  <preGoal name="build-site">
     <delete dir="E:/workspace/mevenide-site"/>
  </preGoal>
  
</project>