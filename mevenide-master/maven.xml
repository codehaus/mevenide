<project xmlns:maven="jelly:maven" 
		 xmlns:j="jelly:core"
		 xmlns:util="jelly:util"
		 xmlns:ant="jelly:ant">
  
  <!-- ==================================== -->
  <!--             build section            -->
  <!-- ==================================== -->
  <goal name="mevenide:build-all" description="Build all Mevenide modules" prereqs="mevenide:clean,mevenide:init">
    <attainGoal name="multiproject:goal"/>
    <attainGoal name="mevenide:create-update-dist"/>
  </goal>
  
  <goal name="mevenide:build-site" description="Build Mevenide Site" prereqs="mevenide:prepare-site-resources">
  	<j:set var="maven.multiproject.includes" value="${maven.multiproject.includes},${mevenide.eclipse.plugin.project.name}/project.xml,${mevenide.spinner.wiki.project.name}/project.xml"/>
  	<attainGoal name="multiproject:site"/>
  </goal>
  
  
  <!-- ==================================== -->
  <!--             wiki section             -->   
  <!-- ==================================== -->
  <goal name="mevenide:spinner-wiki-templates" description="Build Mevenide Site">
  	<attainGoal name="spinner-wiki:generate-templates"/>
  </goal>
  
  
  <!-- ==================================== -->
  <!--             init section             -->
  <!-- ==================================== -->
  <goal name="mevenide:clean" prereqs="clean:clean">
  	<ant:delete dir="${maven.repo.local}/eclipse" quiet="true"/>
  	<ant:delete dir="${maven.repo.local}/mevenide" quiet="true"/>
  </goal>
  
  <goal name="mevenide:init" description="Copy eclipse dependencies to maven.repo.local if necessary">
    <util:file var="installScript" name="${basedir}/install-dependencies.xml"/>
    <j:include file="${installScript}"/>
  </goal>  
  
  <goal name="mevenide:prepare-site-resources" description="Copy the site resources into xdocs directories">
  	<j:forEach var="project" items="${maven.multiproject.includes}">
  	  <ant:copy todir="${project}/xdocs/images">
  	  	<fileset dir="${mevenide.master.project.location}/xdocs/images" includes="*.*"/>
  	  </ant:copy>
  	</j:forEach>
  </goal>
  
  
  <!-- ==================================== -->
  <!--        plugin creation section       -->
  <!-- ==================================== -->
  <goal name="mevenide:create-update-dist" prereqs="mevenide:init" description="Build Eclipse plugin update site">
   	<util:file var="updateSiteProjectDescriptor" name="${mevenide.eclipse.update.project.location}/project.xml"/>
    <maven:maven descriptor="${updateSiteProjectDescriptor}" goals="eclipse-plugin:create-artifact-dist"/>
  </goal>
  
  <preGoal name="eclipse-plugin:install-artifact">
  	<util:file var="filters" name="${mevenide.master.project.location}/init-filtersets.xml"/>
  	<j:include file="${filters}"/>
  </preGoal>


  <!-- ==================================== -->
  <!--           optional section           -->
  <!-- ==================================== -->
  <goal name="mevenide:install-maven-eclipse-plugin-plugin" description="Checkout maven-eclipse-plugin-plugin from cvs and install it">
  	 <attainGoal name="scm:checkout-project"/>
  	 <util:file var="mavenEclipsePluginPluginPom" name="${maven.scm.checkout.dir}/maven-plugins/maven-eclipse-plugin-plugin/project.xml"/>
	 <maven:maven descriptor="${mavenEclipsePluginPluginPom}" goals=" plugin:install,plugin:deploy"/>
  </goal>  
  
  <goal name="mevenide:build-core" description="Build Mevenide-core module">
  	 <util:file var="mevenideCoreProjectdescriptor" name="${mevenide.core.project.location}/project.xml"/>
	 <maven:maven descriptor="${mevenideCoreProjectdescriptor}" goals="clean,jar:install"/> 	 
  </goal>
  
  <goal name="mevenide:build-master-site" description="Build Master Site">
  	<j:set var="maven.multiproject.includes" value="${mevenide.master.project.name}/project.xml"/>
  	<attainGoal name="multiproject:site"/>
  </goal>
  
  <goal name="mevenide:build-xdoc" description="Build each module doco, without aggregating them. Provided for convenience, since building the whole can take a long time.">
  	<j:set var="maven.multiproject.includes" value="${maven.multiproject.includes},${mevenide.eclipse.plugin.project.name}/project.xml"/>
  	<j:set var="goal" value="xdoc"/>
  	<attainGoal name="multiproject:goal"/>
  </goal>
  
</project>
