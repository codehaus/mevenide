<project default="build-all" 
		 xmlns:maven="jelly:maven" 
		 xmlns:j="jelly:core"
		 xmlns:velocity="jelly:org.apache.commons.jelly.tags.velocity.VelocityTagLibrary">


  <!-- 
  	TODO "debug" site generation !!!
  -->
 
  <preGoal name="build">
	<!-- 
		crappy trick to be removed when maven-new released
	-->
	
	<copy todir="${maven.repo.local}/maven-new/jars" file="../mevenide-core/lib/maven-core-1.0-beta-11-SNAPSHOT.jar"/>
	
	
	<!-- set eclipse.home property -->
	<property environment="env"/>
  	<property name="eclipse.home" location="${env.ECLIPSE_HOME}"/>
	
	<!-- find swt.plugin.dir -->
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.gtk_2.1.0/ws/gtk"
			   file="${eclipse.home}/plugins/org.eclipse.swt.gtk_2.1.0/ws/gtk/swt.jar"/>

	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.gtk1x_2.1.0/ws/gtk1x"
			   file="${eclipse.home}/plugins/org.eclipse.swt.gtk1x_2.1.0/ws/gtk1x/swt.jar/swt.jar"/>
		
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.motif_2.1.0/ws/motif"
			   file="${eclipse.home}/plugins/org.eclipse.swt.motif_2.1.0/ws/motif/swt.jar"/>		   
				   		   				   
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.photon_2.1.0/ws/photon"
			   file="${eclipse.home}/plugins/org.eclipse.swt.photon_2.1.0/ws/photon/swt.jar"/>		   
				   				   		   				   
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.win32_2.1.0/ws/win32"
			   file="${eclipse.home}/plugins/org.eclipse.swt.win32_2.1.0/ws/win32/swt.jar"/>
	
  	<!-- 
  	  ensure that all dependencies are present in the repository 
  	  by copying all needed eclipse-plugins jars
  	-->
  	<copy file="${eclipse.home}/plugins/org.eclipse.core.resources_2.1.0/resources.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-resources-2.1.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.core_2.1.0/dtcore.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-dtcore-2.1.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.ui_2.1.0/dtui.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-dtui-2.1.0.jar"/>
  
    <copy file="${eclipse.home}/plugins/org.eclipse.jdt.core_2.1.0/jdtcore.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-jdtcore-2.1.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.jdt.launching_2.1.0/launching.jar" 
  	  	  tofile="${maven.repo.local}/eclipse/jars/eclipse-launching-2.1.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.jface_2.1.0/jface.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-jface-2.1.0.jar"/>  	
  	
  	<copy file="${eclipse.home}/plugins/org.eclipse.core.runtime_2.1.0/runtime.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-runtime-2.1.0.jar"/> 
  		  
  	<copy file="${eclipse.home}/plugins/org.eclipse.ui.workbench_2.1.0/workbench.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-workbench-2.1.0.jar"/> 
    
    <copy file="${eclipse.home}/plugins/org.eclipse.jdt.ui_2.1.0/jdt.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-jdt-2.1.0.jar"/> 
  	
    <copy file="${eclipse.home}/plugins/org.eclipse.ui.views_2.1.0/views.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-views-2.1.0.jar"/> 
  		  
    <copy file="${eclipse.home}/plugins/${swt.plugin.dir}/swt.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-swt-2.1.0.jar"/>  
  </preGoal>
 
 
  <goal name="build-all"
    	description="Build all Mevenide modules">
    <attainGoal name="build"/>
  </goal>
  
  
  <goal name="build" description="Build each Mevenide module">
	
    <maven:reactor basedir=".."
      			   includes="goals-grabber/project.xml,mevenide-core/project.xml,mevenide-ui-eclipse/project.xml"
      			   excludes="mevenide-master/project.xml"
      			   goals="clean,jar:install"
      			   banner="Building"
      			   ignoreFailures="false"/>
    
  </goal>
  
  
  
  <!-- build the aggregated site -->
  <goal name="build-site" description="Build Mevenide Site">
  	
  	<maven:reactor basedir=".."
      			   includes="goals-grabber/project.xml,mevenide-core/project.xml,mevenide-ui-eclipse/project.xml,mevenide-master/project.xml"
      			   goals="clean,site,site:fsdeploy"
      			   excludes=""
      			   banner="Building Site"
      			   ignoreFailures="false"
      			   postProcessing="true"/>
      			   
	<!-- fileScanner var="templates">
      <fileset dir="${basedir}/templates">
        <include name="*.xml"/>
      </fileset>
    </fileScanner>
  	
  	<j:forEach var="template" items="${templates.iterator()}">
      
      <j:set var="templateName" value="${template.name}"/>
      <echo>Processing ${templateName} template ...</echo> 
    
      <velocity:merge name="${basedir}/xdocs/${templateName}"
        			  basedir="${basedir}/templates"
        			  template="${templateName}"/>

    </j:forEach -->
    
  </goal>
 
</project>