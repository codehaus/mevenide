<project xmlns:maven="jelly:maven" 
		 xmlns:j="jelly:core"
		 xmlns:util="jelly:util"
		 xmlns:ant="jelly:ant">
  
  <!-- ==================================== -->
  <!--             build section            -->
  <!-- ==================================== -->
  <goal name="mevenide-eclipse:build" description="Build all Mevenide modules" prereqs="mevenide-eclipse:clean,mevenide-eclipse:init">
    <j:set var="maven.multiproject.includes" value="${maven.multiproject.eclipse.includes}"/>
    <attainGoal name="multiproject:goal"/>
    <attainGoal name="mevenide-eclipse:create-update-dist"/>
  </goal>
  
  <goal name="mevenide-netbeans:build" description="Build all Mevenide modules" prereqs="mevenide-netbeans:init">
      <j:set var="maven.multiproject.includes" value="${maven.multiproject.netbeans.includes}"/>
      <j:set var="maven.jar.manifest" value="${basedir}/../${mevenide.ui.netbeans.project.name}/src/conf/manifest.mf"/> 
      <attainGoal name="multiproject:goal"/>
  </goal>
  
  
  <!-- ==================================== -->
  <!--            site generation           -->   
  <!-- ==================================== -->
  <goal name="mevenide-site:build" description="Build Mevenide Site" prereqs="mevenide:init-site">
  	<j:set var="maven.multiproject.includes" value="${maven.multiproject.site.includes}"/>
  	<attainGoal name="multiproject:site"/>
  	<attainGoal name="mevenide-site:build-archive"/>
  </goal>
  
  <!-- do NOT call site:deploy because we dont want to attain 'site' goal -->
  <goal name="mevenide-site:ssh-deploy" description="Deploy Site" prereqs="mevenide-site:build">
    <attainGoal name="site:sshdeploy"/>
  </goal>
  
  <goal name="mevenide-site:generate-wiki-templates" description="Build Mevenide Site">
  	<attainGoal name="spinner-wiki:generate-templates"/>
  </goal>
  
  
  <!-- ==================================== -->
  <!--             init section             -->
  <!-- ==================================== -->
  <goal name="mevenide-eclipse:clean" prereqs="clean:clean">
    <ant:delete dir="${maven.repo.local}/eclipse" quiet="true"/>
  	<ant:delete dir="${maven.repo.local}/mevenide" quiet="true"/>
  </goal>
  
  <goal name="mevenide:clean-lib">
     <ant:delete>
        <ant:fileset dir="${basedir}" includes="lib/*.jar"/>
     </ant:delete> 
  </goal>
  
  <goal name="mevenide-eclipse:init" description="Copy eclipse dependencies to maven.repo.local if necessary">
    <util:file var="installScript" name="${basedir}/../${mevenide.master.project.name}/scripts/init/install-eclipse-dependencies.xml"/>
    <j:include file="${installScript}"/>
  </goal>  
  
  <goal name="mevenide-netbeans:init" description="Copy eclipse dependencies to maven.repo.local if necessary">
    <util:file var="installScript" name="${basedir}/../${mevenide.master.project.name}/scripts/init/install-netbeans-dependencies.xml"/>
    <j:include file="${installScript}"/>
  </goal>  
  
  <goal name="mevenide:init-site" description="Try to install eclipse and netbeans dependencies. Used to initialize repository before building site.">
      <ant:property environment="env"/>
      <ant:property name="eclipse_home" location="env.ECLIPSE_HOME"/>
      <ant:property name="netbeans_home" location="env.NETBEANS_HOME"/>
      <j:if test="${!empty(eclipse_home)}">
        <attainGoal name="mevenide-eclipse:init"/>
      </j:if>
      <j:if test="${!empty(netbeans_home)}">
        <attainGoal name="mevenide-netbeans:init"/>  
      </j:if>
  </goal>
  
  
  <!-- ==================================== -->
  <!--   eclipse plugins creation section   -->
  <!-- ==================================== -->
  <goal name="mevenide-eclipse:create-update-dist" prereqs="mevenide-eclipse:init" description="Build Eclipse plugin update site">
   	<util:file var="updateSiteProjectDescriptor" name="${mevenide.eclipse.update.project.location}/project.xml"/>
    <maven:maven descriptor="${updateSiteProjectDescriptor}" goals="eclipse-plugin:create-artifact-dist"/>
  </goal>
  
  <preGoal name="eclipse-plugin:install-artifact">
  	<util:file var="filters" name="${mevenide.master.project.location}/scripts/init/init-filtersets.xml"/>
  	<j:include file="${filters}"/>
  </preGoal>


  <!-- ==================================== -->
  <!--           optional section           -->
  <!-- ==================================== -->
  <goal name="mevenide:install-maven-eclipse-plugin-plugin" description="Checkout maven-eclipse-plugin-plugin from cvs and install it">
  	 <attainGoal name="scm:checkout-project"/>
  	 <util:file var="mavenEclipsePluginPluginPom" name="${maven.scm.checkout.dir}/maven-plugins/maven-eclipse-plugin-plugin/project.xml"/>
	 <maven:maven descriptor="${mavenEclipsePluginPluginPom}" goals=" plugin:install,plugin:deploy"/>
  </goal>  
  
  <goal name="mevenide:build-core" description="Build Mevenide-core module">
  	 <util:file var="mevenideCoreProjectdescriptor" name="${mevenide.core.project.location}/project.xml"/>
	 <maven:maven descriptor="${mevenideCoreProjectdescriptor}" goals="clean,jar:install"/> 	 
  </goal>
  
  <goal name="mevenide:build-xdoc" description="Build each module doco, without aggregating them. Provided for convenience, since building the whole can take a long time.">
  	<j:set var="maven.multiproject.includes" value="${maven.multiproject.includes},${mevenide.eclipse.plugin.project.name}/project.xml"/>
  	<j:set var="goal" value="xdoc"/>
  	<attainGoal name="multiproject:goal"/>
  </goal>
  
</project>
