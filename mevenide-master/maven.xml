<project default="build-all" 
		 xmlns:maven="jelly:maven" 
		 xmlns:j="jelly:core"
		 xmlns:velocity="jelly:org.apache.commons.jelly.tags.velocity.VelocityTagLibrary"
		 xmlns:multiproject="multiproject"
		 xmlns:ant="ant">


  <!-- 
  	site generation is now all right thanks the multiproject goal !! 
  -->
 
  <preGoal name="build">
	
	<!-- set eclipse.home property -->
	<property environment="env"/>
  	<property name="eclipse.home" location="${env.ECLIPSE_HOME}"/>
	
	<!-- find swt.plugin.dir -->
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.gtk_3.0.0/ws/gtk"
			   file="${eclipse.home}/plugins/org.eclipse.swt.gtk_3.0.0/ws/gtk/swt.jar"/>

	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.gtk1x_3.0.0/ws/gtk1x"
			   file="${eclipse.home}/plugins/org.eclipse.swt.gtk1x_3.0.0/ws/gtk1x/swt.jar/swt.jar"/>
		
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.motif_3.0.0/ws/motif"
			   file="${eclipse.home}/plugins/org.eclipse.swt.motif_3.0.0/ws/motif/swt.jar"/>		   
				   		   				   
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.photon_3.0.0/ws/photon"
			   file="${eclipse.home}/plugins/org.eclipse.swt.photon_3.0.0/ws/photon/swt.jar"/>		   
				   				   		   				   
	<available property="swt.plugin.dir" 
			   value="org.eclipse.swt.win32_3.0.0/ws/win32"
			   file="${eclipse.home}/plugins/org.eclipse.swt.win32_3.0.0/ws/win32/swt.jar"/>
	
  	<!-- 
  	  ensure that all dependencies are present in the repository 
  	  by copying all needed eclipse-plugins jars
  	-->
  	<copy file="${eclipse.home}/plugins/org.eclipse.core.resources_3.0.0/resources.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-resources-3.0.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.core_3.0.0/dtcore.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-dtcore-3.0.0.jar"/>
  
  	<copy file="${eclipse.home}/plugins/org.eclipse.debug.ui_3.0.0/dtui.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-dtui-3.0.0.jar"/>
  
    <copy file="${eclipse.home}/plugins/org.eclipse.jdt.core_3.0.0/jdtcore.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-jdtcore-3.0.0.jar"/>
  
    <copy file="${eclipse.home}/plugins/org.eclipse.jdt.ui_3.0.0/jdt.jar" 
  	      tofile="${maven.repo.local}/eclipse/jars/eclipse-jdt-3.0.0.jar"/>
  	      
  	<copy file="${eclipse.home}/plugins/org.eclipse.jdt.launching_3.0.0/launching.jar" 
  	  	  tofile="${maven.repo.local}/eclipse/jars/eclipse-launching-3.0.0.jar"/>
  
    <copy file="${eclipse.home}/plugins/org.eclipse.help_3.0.0/help.jar" 
  	  	  tofile="${maven.repo.local}/eclipse/jars/eclipse-help-3.0.0.jar"/>
  	<copy file="${eclipse.home}/plugins/org.eclipse.jface_3.0.0/jface.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-jface-3.0.0.jar"/>  	
  	
  	<copy file="${eclipse.home}/plugins/org.eclipse.jface.text_3.0.0/jfacetext.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-jfacetext-3.0.0.jar"/>  	
  	
  	<copy file="${eclipse.home}/plugins/org.eclipse.text_3.0.0/text.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-text-3.0.0.jar"/>  	
  	
  	<copy file="${eclipse.home}/plugins/org.eclipse.core.runtime_3.0.0/runtime.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-runtime-3.0.0.jar"/> 
  		  
  	<copy file="${eclipse.home}/plugins/org.eclipse.ui.workbench_3.0.0/workbench.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-workbench-3.0.0.jar"/> 
    
  	<copy file="${eclipse.home}/plugins/org.eclipse.ui.workbench.texteditor_3.0.0/texteditor.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-texteditor-3.0.0.jar"/>  	
  	
    <copy file="${eclipse.home}/plugins/org.eclipse.ui.views_3.0.0/views.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-views-3.0.0.jar"/> 
  		  
    <copy file="${eclipse.home}/plugins/org.eclipse.ui.editors_3.0.0/editors.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-editors-3.0.0.jar"/> 
  		  
    <copy file="${eclipse.home}/plugins/org.eclipse.ui.externaltools_3.0.0/externaltools.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-externaltools-3.0.0.jar"/> 

    <copy file="${eclipse.home}/plugins/${swt.plugin.dir}/swt.jar" 
  		  tofile="${maven.repo.local}/eclipse/jars/eclipse-swt-3.0.0.jar"/>  
  		  
  </preGoal>
 
 
  <goal name="build-all"
    	description="Build all Mevenide modules">
    <attainGoal name="build"/>
  </goal>
  
  <goal name="build-core"
    	description="Build Mevenide-core module">
    <maven:reactor basedir="${basedir}/.."
      			   includes="mevenide-core/project.xml"
      			   excludes="goals-grabber/project.xml,mevenide-master/project.xml,mevenide-ui-eclipse/project.xml"
      			   goals="clean,jar:install"
      			   banner="Building"
      			   ignoreFailures="false"/>
	 <!-- 
	 	copy the resulting artifact into plugin lib directory 
	 	Q : how to get the currentVersion and artifactName ? 
	 	R ? copy this to goal to mevenide-core/maven.xml as a postGoal (on ?)
	 -->
     <ant:copy todir="../mevenide-ui-eclipse/lib" file="../mevenide-core/target/mevenide-core-0.1.jar"/>
  </goal>
    
  <!-- i didnt alter it since it works as it is now -->
  <goal name="build" description="Build each Mevenide module">
	
    <!-- maven:reactor basedir="${basedir}/.."
      			   includes="mevenide-goals-grabber/project.xml,mevenide-core/project.xml,mevenide-ui-eclipse/project.xml"
      			   excludes="mevenide-master/project.xml"
      			   goals="clean,jar:install"
      			   banner="Building"
      			   ignoreFailures="false"/ -->
    <attainGoal name="multiproject:goal"/>
  </goal>
  
  
  
  <!-- build the aggregated site -->
  <goal name="build-site" description="Build Mevenide Site">
  	
  	<attainGoal name="multiproject:site"/>
    
  </goal>
 
</project>
