<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core">
	
	<property name="deploiement" value="false"/>
	  

  	
	<postGoal name="jar:install">
		<echo>
			<!-- 
				Deploy Plugin :
				uncomment at deployment time only since i dont want to
				mess my plugins dir (conflict-friendly at dev. time !!)
			-->
		</echo>
		<attainGoal name="mevenide:prepare-lib"/>
		<j:if test="deploiement">
		    <attainGoal name="mevenide:deploy"/>
		</j:if>
	</postGoal>
	
	
	<goal name="mevenide:prepare-lib">
		<!-- copy dependencies to mevenide lib directory -->
		<j:forEach var="dependency" items="${pom.dependencies}">
			<j:if test="${!dependency.groupId.equals('eclipse')}">
            	<copy file="${maven.repo.local}/${dependency.groupId}/${dependency.type}s/${dependency.artifactId}-${dependency.version}.${dependency.type}" 
            		  todir="lib"/>
            </j:if>
        </j:forEach>
	</goal>
	
	<goal name="mevenide:deploy">
		
		<attainGoal name="mevenide:prepare-lib"/>
        <mkdir dir="dist"/>
        
        <zip destfile="dist/org.mevenide-1.0.zip">
        	<fileset dir="${basedir}/icons"/>
        	<fileset dir="${basedir}" includes="plugin.xml,plugin.properties,license.txt"/>
        	<fileset dir="${basedir}/icons"/>
        	<fileset dir="etc" excludes=".cvsignore"/>
        </zip>
        
        <copy file="dist/org.mevenide-1.0.zip"
        	  todir="${eclipse.home}/plugins/org.mevenide_1.0"/>
   </goal>
   
   
</project>

