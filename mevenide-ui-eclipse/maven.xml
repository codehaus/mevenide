<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core">
	
	<property name="deploiement" value="false"/>
	  

  	
	<postGoal name="jar:install">
		<attainGoal name="mevenide:prepare-lib"/>
		<j:if test="${deploiement}">
		    <attainGoal name="mevenide:deploy"/>
		</j:if>
	</postGoal>
	
	
	<goal name="mevenide:prepare-lib">
		<!-- copy dependencies to mevenide lib directory -->
		<j:forEach var="dependency" items="${pom.dependencies}">
			<!--
				shouldnot copy test only dependencies.
				doesnt work for now... 
			-->
			<j:if test="${!(dependency.groupId.equals('eclipse') || dependency.artifactId.startsWith('mock') || dependency.artifactId.endsWith('mock') || dependency.groupId.startsWith('junit'))}">
            	<copy file="${maven.repo.local}/${dependency.groupId}/${dependency.type}s/${dependency.artifactId}-${dependency.version}.${dependency.type}" 
            		  todir="lib"/>
            </j:if>
        </j:forEach>
	</goal>
	
	<goal name="mevenide:deploy">
		
		<!-- attainGoal name="mevenide:prepare-lib"/ -->
        <mkdir dir="dist"/>
        
        <property environment="env"/>
  		<property name="eclipse.home" location="${env.ECLIPSE_HOME}"/>
        
        <mkdir dir="org.mevenide_0.1"/>
        
        <copy todir="org.mevenide_0.1">
        	<fileset dir="${basedir}" includes="icons/*.*"/>
        	<fileset dir="${basedir}" includes="MavenPluginResources.properties"/>
        	<fileset dir="${basedir}" includes="plugin.xml,plugin.properties,license.txt"/>
        	<fileset dir="${basedir}" includes="lib/*.*"/>
        	<fileset dir="${basedir}/target" includes="mevenide-ui-eclipse-0.1.jar"/>
        </copy>
        
        <zip destfile="dist/org.mevenide-0.1-ea.zip">
        	<fileset dir="org.mevenide_0.1"/>
        </zip>
        
        <copy file="dist/org.mevenide-0.1-ea.zip"
        	  todir="${eclipse.home}/plugins/org.mevenide_0.1"/>
        	  
        <delete dir="org.mevenide_0.1"/>
   </goal>
   
   
</project>

