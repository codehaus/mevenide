<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core">
	<postGoal name="jar:install">
		<echo>
			uncomment at deployment time only since i dont want to
			mess my plugins dir (conflict-friendly at dev. time !!)
		</echo>
		<!-- attainGoal name="mevenide:deploy"/ -->
	</postGoal>
	
	<goal name="mevenide:deploy">
		<!-- copy dependencies to mevenide lib directory -->
		<j:forEach var="dependency" items="${pom.dependencies}">
			<j:if test="${!dependency.groupId.equals('eclipse')}">
            	<copy file="${maven.repo.local}/${dependency.groupId}/${dependency.type}s/${dependency.artifactId}-${dependency.version}.${dependency.type}" 
            		  todir="${eclipse.home}/plugins/org.mevenide_1.0/lib"/>
            </j:if>
        </j:forEach>
        
        <!-- copy plugin files to mevenide root directory -->
        <copy todir="${eclipse.home}/plugins/org.mevenide_1.0">
        	<fileset dir="${basedir}" includes="${eclipse.plugin.files}"/>
        </copy>
        
        <!-- copy mevenide-ui-eclipse archive to mevenide root directory -->
        <copy todir="${eclipse.home}/plugins/org.mevenide_1.0">
        	<fileset dir="${maven.repo.local}/mevenide/jars" includes="mevenide-ui-eclipse-${pom.currentVersion}.jar"/>
        </copy>
        
        <!-- copy icons directory to mevenide root -->
        <copy todir="${eclipse.home}/plugins/org.mevenide_1.0/icons">
        	<fileset dir="${basedir}/icons"/>
        </copy>
        
        <!-- 
        	copy META-INF to mevenide root. 
        	TODO use jarResources instead 
        -->
        <copy todir="${eclipse.home}/plugins/org.mevenide_1.0/META-INF/services">
			<fileset dir="${basedir}/../mevenide-core/etc/META-INF/services"/>
		</copy>	
		
		<!-- copy resources to mevenide root -->
		<copy todir="${eclipse.home}/plugins/org.mevenide_1.0">
			<fileset dir="etc"/>
		</copy>	
		
	</goal>
	
</project>

